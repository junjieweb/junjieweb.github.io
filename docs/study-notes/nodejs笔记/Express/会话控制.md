---
sidebar_position: 4
---

# 会话控制

HTTP协议是一个无状态的协议，它无法区分多次请求是否发送自同一客户端。

而我们在实际的使用中，却又大量的这种需求，我们需要通过会话的控制来解决该问题。

## cookie

### cookie是什么？

cookie本质是一个存储在浏览器的文本，随着http请求自动传递给服务器。

- cookie 是存在于『浏览器端』。
- cookie 会存在于 HTTP 请求的『请求头』中，传递给服务器 。

**也可以说cookie是一个头（请求头/响应头）：**

- 服务器以响应头的形式将Cookie发送给浏览器
- 浏览器收到以后会自动将Cookie保存
- 浏览器再次访问服务器时，会以请求头的形式将Cookie发回
- 服务器就可以通过检查浏览器发回的Cookie来识别出不同的浏览器

### cookie的不足

- 各个浏览器对cookie的数量和大小都有不同的限制，这样就导致我们不能在Cookie中保存过多的信息。一般数量不超过50个，单个大小不超过4kb。
- cookie是由服务器发送给浏览器，再由浏览器将cookie发回，如果cookie较大会导致发送速度非常慢，降低用户的体验。

### cookie的使用

```javascript
// cookie-parser
//引入 express
const express = require('express');
//1.引入cookie-parser
const cookieParser = require('cookie-parser');
// 创建应用对象
const app = express();
//2.设置中间件 cookie 方法中间件内部添加的
app.use(cookieParser());
//设置路由
app.get('/', (request, response) => {
    response.send('Hello');
});

//设置cookie
app.get('/set-cookie', (request, response) => {
    //3.设置cookie
    response.cookie('email', '163');
    //设置带有时效性的 cookie   单位 毫秒
    response.cookie('name', 'Tom', {maxAge: 3 * 60 * 1000});
    response.send('cookie的设置');
})

//获取cookie
app.get('/get-cookie', (request, response) => {
    //读取cookie
    console.log(request.cookies);

    response.send('cookie的读取');
})
//清空 cookie
app.get('/clear-cookie', (request, response) => {
    response.clearCookie('email');
    response.send('清空cookie');
})

app.listen(80, () => {
    console.log('服务已经启动，端口80监听中');
});
```

### 注意点

- cookie 虽然存在于浏览器端, 但是在电脑中不能直接查看 cookie 的内容.
- cookie 是按照 『域名』 进行分类保存的
- 发送请求时, 只会携带当前域名下的 cookie 进行请求
- cookie 是由服务器『响应』回来的 (响应头)
- set-cookie 中的 『path=/』 是设置此 cookie 生效的路径, / 表明此 cookie 在当前网站下都可用
- 带有时效性的 cookie, 关闭浏览器不会销毁此 cookie.
- 不带时效性的 cookie, 关闭浏览器就会销毁, 如果不关闭浏览器, 此 cookie 就一直有效
- cookie 体积不宜过大, 会影响请求的效率
- cookie 一般会存储与当前用户相关信息, 例如唯一标识, 用户信息

